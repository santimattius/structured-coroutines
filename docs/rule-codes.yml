# Structured Coroutines â€” shared rule manifest
# Single source of truth for rule codes, suppression IDs, and doc links.
# Used to keep SUPPRESSING_RULES.md and tool messages consistent.
# Reference: BEST_PRACTICES_COROUTINES.md

doc_base: "https://github.com/santimattius/structured-coroutines/blob/main/docs/BEST_PRACTICES_COROUTINES.md"

rules:
  - code: SCOPE_001
    section: "1.1"
    title: "Using GlobalScope in Production Code"
    doc_anchor: "11-using-globalscope-in-production-code"
    compiler: [GLOBAL_SCOPE_USAGE]
    detekt: [GlobalScopeUsage]
    lint: [GlobalScopeUsage]
    intellij: [GlobalScopeUsage]
    default_severity: error

  - code: SCOPE_002
    section: "1.2"
    title: "Using async Without Calling await"
    doc_anchor: "12-scope_002--using-async-without-calling-await"
    compiler: [UNUSED_DEFERRED]
    detekt: [UnusedDeferred]
    lint: [AsyncWithoutAwait]
    intellij: [AsyncWithoutAwait]
    default_severity: error

  - code: SCOPE_003
    section: "1.3"
    title: "Breaking Structured Concurrency"
    doc_anchor: "13-scope_003--breaking-structured-concurrency"
    compiler: [UNSTRUCTURED_COROUTINE_LAUNCH, INLINE_COROUTINE_SCOPE]
    detekt: [ExternalScopeLaunch, InlineCoroutineScope]
    lint: [UnstructuredLaunch, InlineCoroutineScope]
    intellij: [UnstructuredLaunch, InlineCoroutineScope]
    default_severity: error

  - code: RUNBLOCK_001
    section: "2.1"
    title: "Using launch on the Last Line of coroutineScope"
    doc_anchor: "21-runblock_001--using-launch-on-the-last-line-of-coroutinescope"
    compiler: [REDUNDANT_LAUNCH_IN_COROUTINE_SCOPE]
    detekt: [RedundantLaunchInCoroutineScope]
    lint: [RedundantLaunchInCoroutineScope]
    intellij: []
    default_severity: warning

  - code: RUNBLOCK_002
    section: "2.2"
    title: "Using runBlocking Inside Suspend Functions"
    doc_anchor: "22-runblock_002--using-runblocking-inside-suspend-functions"
    compiler: [RUN_BLOCKING_IN_SUSPEND]
    detekt: [RunBlockingInSuspend]
    lint: [RunBlockingInSuspend]
    intellij: [RunBlockingInSuspend]
    default_severity: warning

  - code: DISPATCH_001
    section: "3.1"
    title: "Mixing Blocking Code with Wrong Dispatchers"
    doc_anchor: "31-dispatch_001--mixing-blocking-code-with-wrong-dispatchers"
    compiler: []
    detekt: [BlockingCallInCoroutine]
    lint: [MainDispatcherMisuse]
    intellij: [MainDispatcherMisuse]
    default_severity: warning

  - code: DISPATCH_003
    section: "3.3"
    title: "Abusing Dispatchers.Unconfined"
    doc_anchor: "33-dispatch_003--abusing-dispatchersunconfined"
    compiler: [DISPATCHERS_UNCONFINED_USAGE]
    detekt: [DispatchersUnconfined]
    lint: [DispatchersUnconfined]
    intellij: [DispatchersUnconfined]
    default_severity: warning

  - code: DISPATCH_004
    section: "3.4"
    title: "Passing Job() Directly as Context to Builders"
    doc_anchor: "34-dispatch_004--passing-job-directly-as-context-to-builders"
    compiler: [JOB_IN_BUILDER_CONTEXT]
    detekt: [JobInBuilderContext]
    lint: [JobInBuilderContext]
    intellij: [JobInBuilderContext]
    default_severity: error

  - code: CANCEL_001
    section: "4.1"
    title: "Ignoring Cancellation in Intensive Loops"
    doc_anchor: "41-cancel_001--ignoring-cancellation-in-intensive-loops"
    compiler: []
    detekt: [LoopWithoutYield]
    lint: [LoopWithoutYield]
    intellij: []
    default_severity: warning

  - code: CANCEL_003
    section: "4.3"
    title: "Swallowing CancellationException"
    doc_anchor: "43-cancel_003--swallowing-cancellationexception"
    compiler: [CANCELLATION_EXCEPTION_SWALLOWED]
    detekt: [CancellationExceptionSwallowed]
    lint: [CancellationExceptionSwallowed]
    intellij: [CancellationExceptionSwallowed]
    default_severity: warning

  - code: CANCEL_004
    section: "4.4"
    title: "Suspendable Cleanup Without NonCancellable"
    doc_anchor: "44-cancel_004--suspendable-cleanup-without-noncancellable"
    compiler: [SUSPEND_IN_FINALLY_WITHOUT_NON_CANCELLABLE]
    detekt: [SuspendInFinally]
    lint: [SuspendInFinally]
    intellij: [SuspendInFinally]
    default_severity: warning

  - code: CANCEL_005
    section: "4.5"
    title: "Reusing a Cancelled CoroutineScope"
    doc_anchor: "45-cancel_005--reusing-a-cancelled-coroutinescope"
    compiler: []
    detekt: [ScopeReuseAfterCancel]
    lint: [ScopeReuseAfterCancel]
    intellij: [ScopeReuseAfterCancel]
    default_severity: warning

  - code: EXCEPT_002
    section: "5.2"
    title: "Extending CancellationException for Domain Errors"
    doc_anchor: "52-except_002--extending-cancellationexception-for-domain-errors"
    compiler: [CANCELLATION_EXCEPTION_SUBCLASS]
    detekt: [CancellationExceptionSubclass]
    lint: [CancellationExceptionSubclass]
    intellij: [CancellationExceptionSubclass]
    default_severity: error

  - code: TEST_001
    section: "6.1"
    title: "Slow Tests with Real Delays"
    doc_anchor: "61-test_001--slow-tests-with-real-delays"
    compiler: []
    detekt: [RunBlockingWithDelayInTest]
    lint: [RunBlockingWithDelayInTest]
    intellij: []
    default_severity: warning

  - code: ARCH_002
    section: "8.2"
    title: "Lifecycle-Aware Flow Collection (Android)"
    doc_anchor: "82-lifecycle-aware-flow-collection-android"
    compiler: []
    detekt: []
    lint: [LifecycleAwareScope, ViewModelScopeLeak]
    intellij: []
    default_severity: warning
    notes: "Android-only; not implemented in Detekt or Compiler."
